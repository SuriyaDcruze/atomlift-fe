name: Deploy React Frontend to EC2

on:
 push:
  branches:
   - main  # Trigger deployment on push to main branch

jobs:
 build-and-deploy:
  runs-on: self-hosted  # Use your EC2 GitHub runner
 
  steps:
   - name: Checkout repository
     uses: actions/checkout@v3

   - name: Setup Node.js
     uses: actions/setup-node@v3
     with:
      node-version: '20'

   - name: Install dependencies
     run: npm ci

   - name: Build React App
     run: npm run build

   - name: Deploy React App to Nginx
     run: |
      # Create deployment folder
      sudo mkdir -p /var/www/react-app
      
      # Copy build files to deployment folder
      sudo cp -r build/* /var/www/react-app/
      
      # Clear default Nginx HTML and copy the app
      sudo rm -rf /usr/share/nginx/html/*
      sudo cp -r /var/www/react-app/* /usr/share/nginx/html/
      
      # Restart Nginx to serve the new app
      sudo systemctl restart nginx

